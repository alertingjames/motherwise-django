<html>

<head>

<title>Home | MotherWise Nest</title>

{% load static %}
{% load tag_library %}

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script type="text/javascript" src="https://cdn.rawgit.com/asvd/dragscroll/master/dragscroll.js"></script>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="shortcut icon" href="/static/images/icon.png" type="image/jpg">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<link href='https://fonts.googleapis.com/css?family=Satisfy' rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="/static/style.css"/>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.1/css/all.css">

<link href="/static/images/icons/apple-touch-icon.png" rel="apple-touch-icon" />
<link href="/static/images/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" />
<link href="/static/images/icons/apple-touch-icon-167x167.png" rel="apple-touch-icon" sizes="167x167" />
<link href="/static/images/icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" />
<link href="/static/images/icons/icon-hires.png" rel="icon" sizes="192x192" />
<link href="/static/images/icons/icon-normal.png" rel="icon" sizes="128x128" />

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="/static/reactions/jquery-2.1.4.js"></script>
<script src="/static/reactions/jquery-ui_1.12.1_.min.js"></script>
<script src="/static/reactions/facebook-reactions.js"></script>
<link rel="stylesheet" href="/static/reactions/stylesheet.css">
<link rel="stylesheet" href="/static/css/v1/testhome.css">

</head>


<body>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
<script>

WebFont.load({
    google: {
        families: ["Lato:100,300,400,700,900","Karla:regular","Cookie:regular"]
    }
});

$(document).ready(function() {
	$('.FB_reactions').facebookReactions({
		postUrl: "mother"
	});
});

var isSafari = navigator.vendor && navigator.vendor.indexOf('Apple') > -1 &&
               navigator.userAgent &&
               navigator.userAgent.indexOf('CriOS') == -1 &&
               navigator.userAgent.indexOf('FxiOS') == -1;
if (isSafari) {
    console.log("Safari, yeah!");
}else{
    history.pushState(null, null, location.href);
    history.back();
    history.forward();
    window.onpopstate = function () { history.go(1); };
}

</script>

<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
<script>
    var OneSignal = window.OneSignal || [];
    OneSignal.push(function(){
        OneSignal.init({
            appId:"a15ac902-c246-45ad-95f0-83f5ce8fcace",
            autoRegister: false,
            notifyButton: {
                enable: true,
            },
        });
        OneSignal.registerForPushNotifications();
    });

    OneSignal.push(function() {
        OneSignal.getUserId(function(userId) {
            // console.log('OneSignal Player ID: ' + userId);
        });
    });
</script>


<div id="no_result" class="no-result">
    No post found ...
</div>

<img src="/static/images/processing.gif" id="gif">

<div class="main">
    <div class="header">
        <div class="logo-container">
            <img src="/static/images/logo.png" class="logo">
            <img src="/static/images/logotitle.png" class="logotitle">
        </div>
        <div class="dropdown">
            <i id="main-menu" class="fa fa-ellipsis-h"></i>
            <div id="main-dropdown-menu" class="main-dropdown-content">
                <a href="/mothers/home" style="display:none;">
                    <div><i class="fas fa-user-friends" aria-hidden="true"></i><div>Network</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="javascript:void(0)" onclick="javascript:openCohortBox();">
                    <div><i class="fa fa-sitemap" aria-hidden="true"></i><div>Groups</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="javascript:void(0)" onclick="javascript:openGroupBox();" style="display:none;">
                    <div><i class="fa fa-group" aria-hidden="true"></i><div>Communities</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="/mothers/conferences">
                    <div><i class="glyphicon glyphicon-facetime-video" aria-hidden="true"></i><div>Workshop Videos</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="/mothers/comidaconnection">
                    <div><i class="fas fa-bacon" aria-hidden="true"></i><div>Comida Connection</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="/mothers/mineppppp">
                    <div><i class="fa fa-flag" aria-hidden="true"></i><div>My Posts</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="javascript:void(0)" onclick="toPostCreateForm()">
                    <div><i class="fa fa-plus" aria-hidden="true"></i><div>Create Post</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="/mothers/notifications">
                    <div style="position:relative;">
                        <i class="far fa-comment-alt" aria-hidden="true"></i>
                        <div>Messages</div>
                        <i class="fa fa-angle-right right-arrow" aria-hidden="true"></i>
                        <span class="badge">0</span>
                    </div>
                </a>
                <a href="/mothers/analytics" style="display:none;">
                    <div><i class="fas fa-analytics" aria-hidden="true"></i><div>Analytics</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
            </div>
        </div>
        <div class="flex-grow-1"></div>
        <div class="dropdown">
            <i id="sear" class="fa fa-search" onclick="openSearchMenu()"></i>
            <div id="sear-dropdown-menu" class="sear-dropdown-content">
                <a href="#">
                    <form id="s-form" autocomplete="off">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="text" class="form-control" name="q" value="" placeholder="Type a keyword...">
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-success" onclick="searchHome()"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </form>
                </a>
                <a href="javascript:void(0)" onclick="location.reload();">
                    <div><i class="fa fa-refresh" aria-hidden="true"></i><div>Refresh Posts</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
            </div>
        </div>
        <div class="dropdown">
            <i id="notif" class="fa fa-bell" onclick="openNotifMenu()"></i>
            <div id="msg-dropdown-menu" class="msg-dropdown-content">
                <div id="chat_log">
                    <div id="list">
                        <button onclick="if(document.getElementById('list2').innerHTML == ''){alert('No history browsing'); return;}
                                document.getElementById('notiLayout').style.display='block';">Click here to browse history...</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="dropdown">
            <img src="{% if me.photo_url %}{{me.photo_url}}{% else %}/static/images/ic_profile.png{% endif %}" id="prof" onclick="openAccountMenu()">
            <div id="acc-dropdown-menu" class="acc-dropdown-content">
                <div>
                    <img src="{% if me.photo_url %}{{me.photo_url}}{% else %}/static/images/ic_profile.png{% endif %}">
                    <div>{{me.name}}</div>
                </div>
                <a href="/mothers/account/" onclick="document.getElementById('acc-dropdown-menu').classList.toggle('show');">
                    <div><i class="far fa-user-circle" aria-hidden="true"></i><div>See Profile</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
                <a href="/mothers/logout">
                    <div><i class="fa fa-sign-out" aria-hidden="true"></i><div>Log Out</div><i class="fa fa-angle-right" aria-hidden="true"></i></div>
                </a>
            </div>
        </div>
        <script>
            function openNotifMenu() {
                document.getElementById("msg-dropdown-menu").classList.toggle("show");
            }
            function openAccountMenu() {
                document.getElementById("acc-dropdown-menu").classList.toggle("show");
            }
            function openMainMenu() {
                document.getElementById("main-dropdown-menu").classList.toggle("show");
            }
            function openSearchMenu() {
                document.getElementById("sear-dropdown-menu").classList.toggle("show");
            }

            // Close the dropdown if the user clicks outside of it
            window.onclick = function(event) {
                if (!event.target.matches('#prof')) {
                    var dropdowns = document.getElementsByClassName("acc-dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) {
                        var openDropdown0 = dropdowns[i];
                        if (openDropdown0.classList.contains('show')) {
                            openDropdown0.classList.remove('show');
                        }
                    }
                }
                if (!event.target.matches('#notif')) {
                    var dropdowns = document.getElementsByClassName("msg-dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
                if (!event.target.matches('#main-menu')) {
                    var dropdowns = document.getElementsByClassName("main-dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
                if (!event.target.matches('#sear')) {
                    var dropdowns = document.getElementsByClassName("sear-dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
            }

        </script>
    </div>

    <div class="w-100 text-center pl-2 pr-2">
        <div class="welcome-text">Welcome To MotherWise Nest!</div>
        <div class="marquee-container">
            <marquee direction="left">
                <div id="marquee-text">Please connect, message, and meet the other members via Communities, Groups, Posts and Messages!</div>
            </marquee>
            <div class="left-grad"></div>
            <div class="right-grad"></div>
        </div>
    </div>

    <center><img src="/static/images/progressbar.gif" class="top-progress"></center>

    <div class="body">
        <div>
            <div id="post-container">
                {% if list %}
                {% for post in list %}
                <div class="postform" id="{{post.id}}">
                    <div class="contentform">
                        <div class="post-header" >
                            <div class="member-photo-section">
                                <a href="javascript:void(0)" onclick="showPosterProfile(this)">
                                    <img src="{% if post.member.photo_url %}{{post.member.photo_url}}{% elif post.member.cohort == 'admin' %}/static/images/manager.jpg{% else %}/static/images/ic_profile.png{% endif %}" class="member-photo">
                                </a>
                            </div>
                            <a href="javascript:void(0)" onclick="showPosterProfile(this)" style="flex-grow:1;">
                                <div class="member-name">
                                    {{post.member.name}}
                                    <div>{% if post.member.cohort == 'admin' %}Manager{% else %}{{post.member.cohort}}{% endif %}</div>
                                </div>
                            </a>

                            <input hidden id="u-id" value="{{post.member.id}}">
                            <input hidden id="u-name" value="{{post.member.name}}">
                            <input hidden id="u-cohort" value="{{post.member.cohort}}">
                            <input hidden id="u-city" value="{{post.member.city}}">
                            <input hidden id="u-photo" value="{{post.member.photo_url}}">
                            <input hidden id="u-admin" value="{{post.member.admin_id}}">
                            <input hidden id="u-registered" value="{{post.member.registered_time}}">

                            {% if 'top' in post.post.status %}<img src="/static/images/top.png" class="top">{% endif %}

                            <a href="/mothers/add_post_comment?post_id={{post.post.id}}">
                                {% if post.member.pk == me.pk %}
                                    <span class="fa fa-pencil action-btn" title="Edit Post"></span>
                                {% else %}
                                    <span class="far fa-comment-alt action-btn" title="Add Comment"></span>
                                {% endif %}
                            </a>

                            {% if post.member.pk == me.pk %}
                                <a href="javascript:void(0)" onclick="confirmDeletion('{{post.post.id}}')">
                                    <span class="fa fa-trash action-btn" title="Delete Post"></span>
                                </a>
                            {% endif %}

                        </div>

                        <div class="form-group text-center cursor-pointer" onclick="window.location.href='/mothers/add_post_comment?post_id={{post.post.id}}';">
                            <div class="text post-title">{{post.post.title}}</div>
                            <div class="post-category">{{post.post.category}}</div>
                            <div class="post-time">{{post.post.posted_time}}</div>
                        </div>

                        {% if post.post.picture_url %}
                        <div class="form-group">
                            <a href="/mothers/add_post_comment?post_id={{post.post.id}}">
                                <div class="post-picture-frame">
                                    <img src="{{post.post.picture_url}}" class="post-picture" onerror="this.onerror=null;this.src='https://rec.or.id/images/article/no-image-available.jpg';">
                                    {% if post.pp_cnt|to_int > 0 %}<label class="pp-cnt">+{{post.pp_cnt}}</label>{% endif %}
                                </div>
                            </a>
                        </div>
                        {% endif %}
                        <div class="form-group">
                            <a href="/mothers/add_post_comment?post_id={{post.post.id}}" class="text post-content">{{post.post.content}}</a>
                        </div>

                        {% for prev in post.prevs %}
                        <div class="form-group prev">
                            <div onclick="window.open('{{prev.site_url}}');">
                                {% if prev.image_url %}
                                <img src="{{prev.image_url}}" onerror="this.style.display='none';">
                                <div>
                                    <label class="max-2lines">{{prev.title}}</label>
                                    {% if prev.description %}<div class="singleline">{{prev.description}}</div>{% endif %}
                                    <div class="prev-link d-flex">
                                        {% if prev.icon_url %}<img src="{{prev.icon_url}}">{% endif %}
                                        <div class="max-2lines">{{prev.site_url}}</div>
                                    </div>
                                </div>
                                {% else %}
                                <div>
                                    <label class="max-2lines">{{prev.title}}</label>
                                    {% if prev.description %}<div class="singleline">{{prev.description}}</div>{% endif %}
                                    <div class="prev-link d-flex">
                                        {% if prev.icon_url %}<img src="{{prev.icon_url}}">{% endif %}
                                        <div class="max-2lines">{{prev.site_url}}</div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}

                        <div class="post-footer">
                            <div class="post-actions">
                                <a class="FB_reactions" data-reactions-type="horizontal" data-unique-id="{{post.post.pk}}" data-emoji-class="{{post.post.liked}}" style="margin-top:-10px;margin-right:15px;">
                                    <span id="flbl-{{post.post.pk}}">{% if post.post.liked %}{{post.post.liked}}{% else %}Like{% endif %}</span>
                                </a>
                                <div id="ricon-container-{{post.post.pk}}" class="ricon-container">
                                    <img src="/static/reactions/emojis/like.svg" class="ricon" id="like-{{post.post.pk}}" style="display:{% if post.post.likes == '' or post.post.likes|to_int == 0 %}none;{% endif %}">
                                    <img src="/static/reactions/emojis/love.svg" class="ricon" id="love-{{post.post.pk}}" style="display:{% if post.post.loves == '' or post.post.loves|to_int == 0 %}none;{% endif %}">
                                    <img src="/static/reactions/emojis/haha.svg" class="ricon" id="haha-{{post.post.pk}}" style="display:{% if post.post.haha == '' or post.post.haha|to_int == 0 %}none;{% endif %}">
                                    <img src="/static/reactions/emojis/wow.svg" class="ricon" id="wow-{{post.post.pk}}" style="display:{% if post.post.wow == '' or post.post.wow|to_int == 0 %}none;{% endif %}">
                                    <img src="/static/reactions/emojis/sad.svg" class="ricon" id="sad-{{post.post.pk}}" style="display:{% if post.post.sad == '' or post.post.sad|to_int == 0 %}none;{% endif %}">
                                    <img src="/static/reactions/emojis/angry.svg" class="ricon" id="angry-{{post.post.pk}}" style="display:{% if post.post.angry == '' or post.post.angry|to_int == 0 %}none;{% endif %}">
                                </div>
                                <label id="feelings-{{post.post.pk}}" style="display:{% if post.post.reactions == '' or post.post.reactions|to_int == 0 %}none;{% endif %}">{{post.post.reactions}}</label>
                                <span class="far fa-comment-alt" onclick="window.location.href='/mothers/add_post_comment?post_id={{post.post.id}}';"></span> {{post.post.comments}}
                            </div>

                            <div class="post-detail-section">
                                <a href="/mothers/add_post_comment?post_id={{post.post.id}}" class="post-detail-btn">
                                    <span class="fas fa-arrow-right"></span>
                                </a>
                            </div>
                        </div>

                        <div class="pc-section">
                            {% for comment in post.comments %}
                            <div>
                                <div>
                                    <img src="{% if comment.member.photo_url %}{{comment.member.photo_url}}{% else %}/static/images/ic_profile.png{% endif %}">
                                    <span>{{comment.member.name}}</span>
                                </div>
                                <div class="text pc-item-comment">{{comment.comment.comment_text}}</div>
                            </div>
                            {% endfor %}
                            {% if post.pc_cnt|to_int > 5 %}
                            <a href="/mothers/add_post_comment?post_id={{post.post.id}}">View more comments</a>
                            {% endif %}
                        </div>

                    </div>

                </div>

                <br>

                {% endfor %}

                {% else %}

                <script>document.getElementById('no_result').style.display = 'block';</script>

                {% endif %}

            </div>
        </div>
    </div>
    <div class="left-menu">
        <div onclick="window.location.href='/mothers/home';" style="display:none;">
            <i class="fas fa-user-friends"></i><div>Network</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
        <div onclick="openCohortBox()">
            <i class="fa fa-sitemap"></i><div>Groups</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
        <div onclick="openGroupBox()" style="display:none;">
            <i class="fa fa-group"></i><div>Communities</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
        <div onclick="window.location.href='/mothers/conferences';">
            <i class="glyphicon glyphicon-facetime-video"></i><div>Workshop Videos</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
        <div onclick="window.location.href='/mothers/comidaconnection';">
            <i class="fas fa-bacon"></i><div>Comida Connection</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
        <div onclick="window.location.href='/mothers/mineppppp';">
            <i class="fa fa-flag"></i><div>My Posts</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
        <div onclick="toPostCreateForm()">
            <i class="fa fa-plus"></i><div>Create Post</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
        <div onclick="window.location.href='/mothers/notifications';" style="position:relative;">
            <i class="far fa-comment-alt"></i>
            <div>Messages</div>
            <i class="fa fa-angle-right" aria-hidden="true"></i>
            <span class="badge">0</span>
        </div>
        <div onclick="window.location.href='/mothers/analytics';" style="display:none;">
            <i class="fas fa-analytics"></i><div>Analytics</div><i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
    </div>

    <div class="right-contactors">
        <div>Contactors</div>
        <div>
            {% if contactors %}
            {% for cont in contactors %}
            <div class="item-cont">
                <div onclick="window.location.href='/mothers/to_private_chat?member_id={{cont.pk}}';">
                    <img src="{% if cont.photo_url %}{{cont.photo_url}}{% else %}/static/images/ic_profile.png{% endif %}">
                    <div>{{cont.name}}</div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="no-cont">You don't have contactor</div>
            <center>
                <div class="meet-cont" onclick="openCohortBox();">Meet them here!</div>
            </center>
            {% endif %}
        </div>
    </div>
</div>

<img src="/static/images/progressbar.gif" class="bottom-progress">


<div id="cohortBox">
    <img class="centered-and-cropped" src="/static/images/ic_profile.png">
    <span class="fa fa-close btn-close"
        onclick="javascript:document.getElementById('cohortBox').style.display='none'; document.getElementById('backgroundOverlay').style.display='none';"></span>
    <div class="box-body">
        <div>
            <div style="font-size:16px; font-weight:600; color: black; text-align:center; width:100%;">CONNECT WITH YOUR GROUP</div><br>
            <form action="/mothers/do_cohort/" method="post" enctype="multipart/form-data" style="width:100%;" id="cohortform">
                {% csrf_token %}
                <div class="form-group">
                    <select name="cohort" required id="cohort2" style="width:100%; color:black; appearance:none; text-align-last:center;">
                        {% for c in cohorts %}
                        {% if c == me.cohort %}
                        <option value="{{c}}">{{c}}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
    			</div>

    			<input hidden id="cohort_option" name="option" value="">
    			<input hidden id="cohort_conf_code" name="code" value="">

                <div class="form-group" style="margin-top:20px; text-align:center;">

                    <div style="width:auto; display:inline-block;">
                        <a href="javascript:void(0)" onclick="javascript:doCohort('members');">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_group.png" style="background-color:orange;"><br>
                                <label class="button-text">Members</label>
                            </div>
                        </a>
                        <a href="javascript:void(0)" onclick="javascript:doCohort('video');" style="visibility:hidden;">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_video.png" style="margin-left:10px; background-color:red;"><br>
                                <label class="button-text" style="margin-left:5px;">Video</label>
                            </div>
                        </a>
                        <a href="javascript:void(0)" onclick="javascript:doCohort('group_chat');">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_group_chat.png" style="margin-left:10px; background-color:#0066cc;"><br>
                                <label class="button-text" style="margin-left:9px;">Group Chat</label>
                            </div>
                        </a>
                        <a href="javascript:void(0)" onclick="javascript:doCohort('private_chat');" style="display:none;">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_chat.png" style="margin-left:10px; background-color:green;"><br>
                                <label class="button-text" style="margin-left:5px;">Priv Chat</label>
                            </div>
                        </a>
                    </div>

                </div>

            </form>
        </div>
    </div>
</div>


<div id="groupBox">
    <img class="centered-and-cropped" src="/static/images/ic_profile.png">
    <span class="fa fa-close" style="font-size:20px; float:right;"
        onclick="javascript:document.getElementById('groupBox').style.display='none'; document.getElementById('backgroundOverlay').style.display='none';"></span>
    <div style="width:100%; display:inline-block;">
        <div>
            <div style="font-size:16px; font-weight:600; color: black; text-align:center; width:100%;">CONNECT WITH A COMMUNITY</div><br>
            <form action="/mothers/do_group/" method="post" enctype="multipart/form-data" style="width:100%;" id="groupform">
                {% csrf_token %}
                <div class="form-group">
                    <div style="margin-left:15px;margin-right:15px;">
                        <select name="groupid" required id="groupid">
                        </select>
                    </div>
                    <script>
                        var x = document.getElementById("groupid");
                        {% if groups %}
                            {% for group in groups %}
                                var option = document.createElement("option");
                                option.text = "{{group.name}}";
                                option.value = "{{group.pk}}";
                                x.add(option);
                            {% endfor %}
                        {% else %}
                            var option = document.createElement("option");
                            option.text = "--No group allowed--";
                            option.value = "";
                            x.add(option);
                        {% endif %}
                    </script>
    			</div>

    			<input hidden id="group_option" name="option" value="">
    			<input hidden id="group_conf_code" name="code" value="">

                <div class="form-group" style="margin-top:20px; text-align:center;">

                    <div style="width:auto; display:inline-block;">
                        <a href="javascript:void(0)" onclick="javascript:doGroup('members');">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_group.png" style="background-color:orange;"><br>
                                <label class="button-text">Members</label>
                            </div>
                        </a>
                        <a href="javascript:void(0)" onclick="javascript:doGroup('video');" style="visibility:hidden;">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_video.png" style="margin-left:10px; background-color:red;"><br>
                                <label class="button-text" style="margin-left:5px;">Video</label>
                            </div>
                        </a>
                        <a href="javascript:void(0)" onclick="javascript:doGroup('group_chat');">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_group_chat.png" style="margin-left:10px; background-color:#0066cc;"><br>
                                <label class="button-text" style="margin-left:2px;">Group Chat</label>
                            </div>
                        </a>
                        <a href="javascript:void(0)" onclick="javascript:doGroup('private_chat');" style="display:none;">
                            <div style="display:inline-block; text-align:center;">
                                <img class="cohort-panel-button" src="/static/images/ic_chat.png" style="margin-left:10px; background-color:green;"><br>
                                <label class="button-text" style="margin-left:5px;">Priv Chat</label>
                            </div>
                        </a>
                    </div>

                </div>

            </form>
        </div>
    </div>
</div>


<div id="notiLayout" style="display:none;" onclick="javascript:dismissLayouts();">
    <center>
        <div style="font-size:16px; font-weight:600; font-family:verdana; color:white; text-align:center; width:280px;
            border-radius:50px; margin-top:10px; margin-bottom:15px; background-color:orange; padding:3px;">
            Contact Again
        </div>
    </center>
    <div id="notiForm">
        <div class="contentform2">
            <div class="formcontent2">
                <div id="chat_log2">
                    <div id="list2"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function showPosterProfile(obj) {
        let selector = ".postform";
        let parentElem = findParentBySelector(obj, selector);
        let userIdBox = parentElem.querySelector("#u-id");
        let userNameBox = parentElem.querySelector("#u-name");
        let userCohortBox = parentElem.querySelector("#u-cohort");
        let userCityBox = parentElem.querySelector("#u-city");
        let userPhotoBox = parentElem.querySelector("#u-photo");
        let userAdminIdBox = parentElem.querySelector("#u-admin");
        let userRegisteredTimeBox = parentElem.querySelector("#u-registered");

        if(userCohortBox.value == "admin") document.getElementById("uNameBox").innerHTML = "MotherWise Manager";
        else document.getElementById("uNameBox").innerHTML = userNameBox.value;

        if(userAdminIdBox.value != '0') document.getElementById("uRegisteredTimeBox").innerHTML = "Member since " + "<label style='font-weight:300;'>" + userRegisteredTimeBox.value + "</label>";
        else document.getElementById("uRegisteredTimeBox").innerHTML = '<label style="font-weight:600; color:orange; opacity:0;">Manager</label>';

        if(userAdminIdBox.value != '0') {
            if(userCohortBox.value.length > 0) {
                document.getElementById("uCohortBox").innerHTML = '<span class="fas fa-user-friends"></span>' +  userCohortBox.value;
                // document.getElementById("uCohortBox").href = "javascript:void(0)";
                document.getElementById("uCohortBox").addEventListener("click", function() { cohortMembers(this.innerHTML.replace('<span class="fas fa-user-friends"></span>', '')) });
            } else document.getElementById("uCohortBox").innerHTML = "--- No Group ---";
        }else document.getElementById("uCohortBox").innerHTML = '<span class="fas fa-user-friends"></span>' +  "MotherWise Community";

        if(userCityBox.value.length > 0) {
            document.getElementById("uCityBox").innerHTML = '<span class="glyphicon glyphicon-map-marker" style="font-size:16px; margin-right:5px;color:white;"></span><span>' + userCityBox.value + '</span>';
        }else document.getElementById("uCityBox").innerHTML = "--- --- ---";

        if(userPhotoBox.value.length > 0) {
            document.getElementById("uPhotoBox").src = userPhotoBox.value;
            document.getElementById("uPhoto").href = userPhotoBox.value;
            document.getElementById("uPhoto").target = "_blank";
        }else {
            if(userCohortBox.value == 'admin') document.getElementById("uPhotoBox").src = '/static/images/logo.jpg';
            else document.getElementById("uPhotoBox").src = '/static/images/ic_profile.png';
        }

        document.getElementById("uPosts").href = "/mothers/qqqqqqqqqqqq?user_id=" + userIdBox.value;
        document.getElementById("uChat").href = "/mothers/to_private_chat?member_id=" + userIdBox.value;
        document.getElementById("profile-section").style.display = "inline-block";
        document.getElementById("backgroundOverlay").style.display = "block";
    }

    function cohortMembers(ch) {
        document.getElementById("profile-cohort").value = ch;
        document.getElementById("profile-cohort-form").submit();
    }

</script>


<form action="/mothers/do_cohort/" method="post" enctype="multipart/form-data" id="profile-cohort-form">
    {% csrf_token %}
	<input hidden name="cohort" id="profile-cohort">
	<input hidden name="option" value="members">
	<input hidden name="code" value="">
</form>


<div id="profile-section">
    <div>
        <div class="profile-body">
            <div>
                <!--<input type="hidden" id="user_id" value="{{user_id}}">-->
                <div class="contentform">
                    <div style="width:100%;">

                        <div id="uNameBox"></div>
                        <div id="uRegisteredTimeBox"></div>
                        <br>
                        <div id="uCohortBox" data-toggle="tooltip" data-placement="top" title="See group members"></div>
                        <br>
                        <br>
                        <div class="uFooter">
                            <div id="uCityBox"></div>
                            <div class="flex-grow-1"></div>
                            <a id="uPosts">
                                <span class="glyphicon glyphicon-flag" title="Posts"></span>
                            </a>
                            <a id="uChat">
                                <span class="fa fa-comments" title="Chat"></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="photo-frame">
            <center>
                <a id="uPhoto">
                    <img id="uPhotoBox">
                        <!--#E5F2FA-->
                </a>
            </center>
        </div>
        <i class="fa fa-close close-profile"></i>
        <br>
    </div>
</div>


<div id="backgroundOverlay" onclick="javascript:dismissLayouts();">
</div>

<input type="hidden" id="me_email" value="{{me.email}}">
<input type="hidden" id="me_id" value="{{me.pk}}">


<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">

<button onclick="topFunction()" class="topBtn" id="topBtn" style="right:15px;"><i class="glyphicon glyphicon-menu-up" style="color:white; font-size:14px;"></i></button>

<div class="trans">
    <div id="google_translate_element" style="float:left;"></div>
</div>
<script type="text/javascript">
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
    }
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
    $( document ).ready(function() {
        $('#google_translate_element').bind('DOMSubtreeModified', function() {
            var val = $(this);
            var strlang = "" + val[0].innerText + "";
            var toolBar = document.getElementsByClassName('goog-te-banner-frame skiptranslate')[0];
            if(toolBar !== undefined) {
                toolBar.style.display  = 'none';
                document.body.style.top = '0px';
            }
        });
    });
</script>

<script>
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        document.getElementById("topBtn").style.display = "block";
    } else {
        document.getElementById("topBtn").style.display = "none";
    }
    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight){
        console.log('scrolled to end')
        if(endindx < total_count - 1) {
            refreshAtBottom();
        }
    }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}

var y = document.getElementsByClassName("text");
var i;
for (i = 0; i < y.length; i++) {
  y[i].innerHTML = urlify(y[i].innerHTML);
  y[i].style.color = "white";
  y[i].style.textAlign = "left";
}

function urlify(text) {
    var urlRegex = /(https?:\/\/[^\s]+)/g;
    return text.replace(urlRegex, function(url) {
        return '<a href="' + url + '" style="color:yellow; word-break: break-all;">' + url + '</a>';
    });
}


$(document).ready(function() {
    $('.postform .text').each(function(i) {
        const response = this.innerHTML
        const decoded = response
            .replace(/\\u(....)/g, (match, p1) => String.fromCharCode(parseInt(p1, 16)))
            .replace(/\\(\d{3})/g, (match, p1) => String.fromCharCode(parseInt(p1,  8)))
        this.innerHTML = decoded;
    });
});

document.getElementsByClassName("close-profile")[0].addEventListener('click', function (event) {
    dismissLayouts();
});


{% if pst %}
ScrollTo({{pst.pk}});
{% endif %}

function ScrollTo(name) {
  //init thread
  ScrollToResolver(document.getElementById(name));
}

function ScrollToResolver(elem) {
  var jump = parseInt(elem.getBoundingClientRect().top * .2);
  document.body.scrollTop += jump - 50;
  document.documentElement.scrollTop += jump - 50;
  //lastjump detects anchor unreachable, also manual scrolling to cancel animation if scroll > jump
  if (!elem.lastjump || elem.lastjump > Math.abs(jump)) {
    elem.lastjump = Math.abs(jump);
    setTimeout(function() {
      ScrollToResolver(elem);
    }, "50");
  } else {
    elem.lastjump = null;
  }
}

</script>

<script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDveaXbV1HHMREyZzbvQe53BJEHVIRCf14",
    authDomain: "motherwise-1585202524394.firebaseapp.com",
    databaseURL: "https://motherwise-1585202524394.firebaseio.com",
    projectId: "motherwise-1585202524394",
    storageBucket: "motherwise-1585202524394.appspot.com",
    messagingSenderId: "805720875706",
    appId: "1:805720875706:web:1e90b519b4cf8ca0f69883",
    measurementId: "G-TLGYEHY3TK"
  };
  firebase.initializeApp(config);
</script>

<script>
	function showNotifications(){
		window.location.href = "/adminNotifications";
	}

</script>

<script>

createjs.Sound.registerSound("/static/sound/notification.mp3", "x");
navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate;

var keys = [];
var me_email = document.getElementById("me_email").value;
me_email = me_email.replace(/\./g,"ddoott");
var ref = firebase.database().ref('notification/' + me_email);
ref.on('child_added', function(snapshot) {
	var key = snapshot.val();
	keys.push(key);
	if(keys.length == 1){
// 		createjs.Sound.play("x");
        document.getElementById("notif").style.backgroundColor = "white";
        document.getElementById("notif").style.color = "red";
		if (navigator.vibrate) {
			// vibration API supported
			navigator.vibrate(500);
		}else {
			window.navigator.vibrate(500); // vibrate for 500ms
		}
	}
});

var keys2 = [];
var me_id = document.getElementById("me_id").value;
var notiref = firebase.database().ref('notify/' + me_id);
notiref.on('child_added', function(snapshot) {
  var key = snapshot.val();
//   console.log(snapshot.key);
  if (key){
    var sender_name = key.sender_name;
    // console.log(key.sender_name);
    var li = document.createElement("div");
    li.style.color = 'black';
    li.style.fontSize = '14';
    li.style.maxWidth = "auto";
    li.style.width = "auto";
    var role_caption = "";
    if(key.role == "manager") role_caption = "<div style='color:white; font-size:10px; margin-left:2px; border-radius:3px; background-color:red; width:auto; padding:0px 6px 0px 6px; display:inline-block;'>Manager</div>";
    li.innerHTML = "<div style='font-size:14px; font-weight:600;'>" + sender_name + "</div>"
        + role_caption
        + "<div style='color:gray; font-size:12px; margin-left:2px;'>" + timeConverter(Number(key.date))
        + "<label style='color:orange; width:auto; text-align:left; font-size:11px; margin-left:8px;'>View message</label>"
        + "</div>";
    // li.innerHTML = li.innerHTML + "<div style='font-size:12px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;'>" + key.msg + "</div>";
    li.style.textAlign = 'left';
    var ul2 = document.createElement("div");
    var img = document.createElement("img");
    var sender_photo = key.sender_photo;
    if (sender_photo.length > 0 && isValidImage(sender_photo)) img.src = sender_photo;
    else img.src = "/static/images/ic_profile.png";
    img.style.width = "40";
    img.style.height = "40";
    img.style.borderRadius = "50%";
    img.classList.add("cropping");
    img.style.cssFloat = 'right';
    ul2.appendChild(img);
    ul2.append(li);
    ul2.style.marginBottom = "1px";
    ul2.addEventListener('click', function (event) {
        var type = key.type
        var id = key.id
        var mes_id = key.mes_id
        if(type == 'gchat'){
            window.location = "/mothers/open_group_chat?group_id=" + id;
        }else if(type == 'cchat'){
            window.location = "/mothers/open_cohort_chat?cohort=" + id;
        }else {
            window.location = "/mothers/notifications?noti_id=" + mes_id;
        }
        notiref.child(snapshot.key).remove();
    });
    ul.appendChild(ul2);

    keys2.push(key);
	if(keys2.length == 1){
// 		createjs.Sound.play("x");
		document.getElementById("notif").style.backgroundColor = "white";
        document.getElementById("notif").style.color = "red";
		if (navigator.vibrate) {
			// vibration API supported
			navigator.vibrate(500);
		}else {
			window.navigator.vibrate(500); // vibrate for 500ms
		}
	}
  }
});



</script>

<script src="/static/js/chat/memb_notification.js"></script>

<script>

    function dismissLayouts(){
        document.getElementById('groupBox').style.display='none';
        document.getElementById('cohortBox').style.display='none';
        document.getElementById('backgroundOverlay').style.display='none';
        document.getElementById('notiLayout').style.display='none';
        document.getElementById('profile-section').style.display='none';
    }

    function doCohort(option){
        if(document.getElementById('cohort2').value == ''){
            showFailureAlert('Please choose a group.');
            return;
        }
        document.getElementById('cohort_option').value = option;
        var form = document.getElementById("cohortform");
        form.submit();
    }

    function doGroup(option){
        if(document.getElementById('groupid').value == ''){
            showFailureAlert('Please choose a community.');
            return;
        }
        document.getElementById('group_option').value = option;
        var form = document.getElementById("groupform");
        form.submit();
    }

</script>

<script>

function formSubmit(form, gif, text){
    gif.style.display = "block";
    var formData = new FormData(form);
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            showSuccessAlert(text);
            gif.style.display = "none";
            dismissLayouts();
        }
    };
    xhr.open('POST', form.getAttribute('action'), true);
    xhr.send(formData);
}


function showSuccessAlert(msg) {
    swal({
        title: "Success!",
        text: msg,
        icon: "success",
        button: "OK",
    });
}

function showFailureAlert(msg) {
    swal({
        title: "Oops! We ran into an issue.",
        text: msg,
        icon: "warning",
        button: "OK",
        dangerMode: true,
    });
}


</script>

<script>

{% if groups %}
{% for group in groups %}

var gref = firebase.database().ref('gmnotis' + {{admin.pk}} + "gr" + {{group.pk}});
gref.on('child_added', function(snapshot) {
  var key = snapshot.val();
  if (key){
    var key2 = getChildObj(key);
    var sender_name = key2.sender;
    var cohort = key2.cohort;
    var groupid = key2.groupid;
//    window.alert(key2.message);
    var li = document.createElement("div");
    li.style.color = 'black';
    li.style.fontSize = '14';
    li.style.maxWidth = "auto";
    li.style.width = "auto";
    li.innerHTML = "<label style='font-size:14px; font-weight:600;'>" + sender_name + "</label>" + "<div style='color:gray; font-size:12px; margin-left:2px;'>" + timeConverter(Number(key2.time)) + "<label style='color:orange; width:auto; text-align:left; font-size:11px; margin-left:8px;'>View message</label>" + "</div>";
    // li.innerHTML = li.innerHTML + "<div style='font-size:12px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;'>" + key2.message + "</div>";
    li.style.textAlign = 'left';
    var ul2 = document.createElement("div");
    var img = document.createElement("img");
    if (key2.sender_photo.length > 0 && isValidImage(key2.sender_photo)) img.src = key2.sender_photo;
    else img.src = "/static/images/ic_profile.png";
    img.style.width = "40";
    img.style.height = "40";
    img.classList.add("cropping");
    img.style.cssFloat = 'right';
    ul2.appendChild(img);
    ul2.append(li);
    ul2.style.marginBottom = "1px";
    ul2.addEventListener('click', function (event) {
        if(groupid != '') window.open('/mothers/open_group_chat?group_id=' + groupid);
        else if(cohort != '') window.open('/mothers/open_cohort_chat?cohort=' + cohort);
    });
    if({{me.pk}} != parseInt(key2.sender_id)){
        ul.appendChild(ul2);
        document.getElementById("notif").style.backgroundColor = "white";
        document.getElementById("notif").style.color = "red";
    }
  }else {
      var lii = document.createElement("div");
      lii.style.color = 'white';
      lii.style.fontSize = '14';
      lii.style.textAlign = 'center';
      lii.innerHTML = "No message ...";
      ul.append(lii);
  }
});

{% endfor %}
{% endif%}


var cref = firebase.database().ref('gmnotis' + {{admin.pk}} + '{{me.cohort}}');
cref.on('child_added', function(snapshot) {
  var key = snapshot.val();
  if (key){
    var key2 = getChildObj(key);
    var sender_name = key2.sender;
    var cohort = key2.cohort;
    var groupid = key2.groupid;
//    window.alert(key2.message);
    var li = document.createElement("div");
    li.style.color = 'black';
    li.style.fontSize = '14';
    li.style.maxWidth = "auto";
    li.style.width = "auto";
    li.innerHTML = "<label style='font-size:14px; font-weight:600;'>" + sender_name + "</label>" + "<div style='color:gray; font-size:12px; margin-left:2px;'>" + timeConverter(Number(key2.time)) + "<label style='color:orange; width:auto; text-align:left; font-size:11px; margin-left:8px;'>View message</label>" + "</div>";
    // li.innerHTML = li.innerHTML + "<div style='font-size:12px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;'>" + key2.message + "</div>";
    li.style.textAlign = 'left';
    var ul2 = document.createElement("div");
    var img = document.createElement("img");
    if (key2.sender_photo.length > 0 && isValidImage(key2.sender_photo)) img.src = key2.sender_photo;
    else img.src = "/static/images/ic_profile.png";
    img.style.width = "40";
    img.style.height = "40";
    img.classList.add("cropping");
    img.style.cssFloat = 'right';
    ul2.appendChild(img);
    ul2.append(li);
    ul2.style.marginBottom = "1px";
    ul2.addEventListener('click', function (event) {
        if(groupid != '') window.open('/mothers/open_group_chat?group_id=' + groupid);
        else if(cohort != '') window.open('/mothers/open_cohort_chat?cohort=' + cohort);
    });
    if({{me.pk}} != parseInt(key2.sender_id)){
        ul.appendChild(ul2);
        document.getElementById("notif").style.backgroundColor = "white";
        document.getElementById("notif").style.color = "red";
    }
  }else {
      var lii = document.createElement("div");
      lii.style.color = 'white';
      lii.style.fontSize = '14';
      lii.style.textAlign = 'center';
      lii.innerHTML = "No message ...";
      ul.append(lii);
  }
});


</script>


<script type = "text/javascript">
    setInterval(getNewNofiCount, 5000);
    function getNewNofiCount(){
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                // console.log(xhr.response);
                var new_msg_count = xhr.response;
                if(parseInt(new_msg_count) > 0) {
                    let badges = document.getElementsByClassName("badge");
                    for(var i=0; i<badges.length; i++) {
                        badges[i].style.display = "block";
                        badges[i].innerHTML = new_msg_count;
                    }
                }else {
                    let badges = document.getElementsByClassName("badge");
                    for(var i=0; i<badges.length; i++) {
                        badges[i].style.display = "none";
                    }
                }
            }
        };
        xhr.open('GET', "/mothers/new_notis", true);
        xhr.send('');
    }
</script>

<script>

var ul0 = document.getElementById("list2");
var keys = [];
me_email = me_email.replace(/\./g,"ddoott");
var notifRef = firebase.database().ref('notification2/' + me_email);
notifRef.on('child_added', function(snapshot) {
  var key = snapshot.val();
  if (key){
    var key2 = getChildObj(key);
    var sender_name = key2.senderName;
//    window.alert(key2.message);
    var li = document.createElement("div");
    li.style.color = 'black';
    li.style.fontSize = '14';
    li.style.maxWidth = "auto";
    li.style.width = "auto";
    li.innerHTML = "<label style='font-size:14px; font-weight:600;'>" + sender_name + "</label>" + "<div style='color:gray; font-size:12px; margin-left:2px;'>" + timeConverter(Number(key2.time)) +
        "<label style='overflow:hidden; text-overflow:ellipsis; white-space:nowrap; font-weight:100; margin-left:8px; float:right; max-width: 160px;'>" + key2.msg + "</label>" + "<label style='color:orange; width:auto; text-align:left; font-size:11px; margin-left:8px;'>Click to contact</label>" + "</div>";
    li.style.textAlign = 'left';
    var ul2 = document.createElement("div");
    var img = document.createElement("img");
    if (key2.senderPhoto.length > 0 && isValidImage(key2.senderPhoto)) img.src = key2.senderPhoto;
    else img.src = "/static/images/manager.jpg";
    img.style.width = "40";
    img.style.height = "40";
    img.style.borderRadius = "50%";
    img.classList.add("cropping");
    img.style.cssFloat = 'right';
    ul2.appendChild(img);
    ul2.append(li);
    ul2.style.marginBottom = "5px";
    ul2.addEventListener('click', function (event) {
       var context = {
            'member_email': key2.sender
       }
       post('/mothers/to_chat/', context);
    //   console.log('/mothers/to_chat/');
    });
    ul0.appendChild(ul2);
  }
});


me_id = document.getElementById("me_id").value;
var notiref2 = firebase.database().ref('notify2/' + me_id);
notiref2.on('child_added', function(snapshot) {
  var key = snapshot.val();
//   console.log(snapshot.key);
  if (key){
    var sender_name = key.sender_name;
    // console.log(key.sender_name);
    var li = document.createElement("div");
    li.style.color = 'black';
    li.style.fontSize = '14';
    li.style.maxWidth = "auto";
    li.style.width = "auto";
    var role_caption = "";
    if(key.role == "manager") role_caption = "<div style='color:white; font-size:10px; margin-left:2px; border-radius:3px; background-color:red; width:auto; padding:0px 6px 0px 6px; display:inline-block;'>Manager</div>";
    li.innerHTML = "<div style='font-size:14px; font-weight:600;'>" + sender_name + "</div>"
        + role_caption
        + "<div style='color:gray; font-size:12px; margin-left:2px;'>" + timeConverter(Number(key.date))
        + "<label style='color:orange; width:auto; text-align:left; font-size:11px; margin-left:8px;'>View message</label>"
        + "</div>";
    // li.innerHTML = li.innerHTML + "<div style='font-size:12px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;'>" + key.msg + "</div>";
    li.style.textAlign = 'left';
    var ul2 = document.createElement("div");
    var img = document.createElement("img");
    var sender_photo = key.sender_photo;
    if (sender_photo.length > 0 && isValidImage(sender_photo)) img.src = sender_photo;
    else img.src = "/static/images/ic_profile.png";
    img.style.width = "40";
    img.style.height = "40";
    img.style.borderRadius = "50%";
    img.classList.add("cropping");
    img.style.cssFloat = 'right';
    ul2.appendChild(img);
    ul2.append(li);
    ul2.style.marginBottom = "1px";
    ul2.addEventListener('click', function (event) {
        var type = key.type
        var id = key.id
        var mes_id = key.mes_id
        if(type == 'gchat'){
            window.location = "/mothers/open_group_chat?group_id=" + id;
        }else if(type == 'cchat'){
            window.location = "/mothers/open_cohort_chat?cohort=" + id;
        }else {
            window.location = "/mothers/notifications?noti_id=" + mes_id;
        }
        notiref2.child(snapshot.key).remove();
    });
    ul0.appendChild(ul2);

  }
});

function isValidImage(imageurl) {
   try {
        var img = document.createElement("img");
        img.src = imageurl;
    } catch(err) {
        //
    }

    if(img.height > 0) {
        return true;
    } else {
        return false;
    }
}


for(var i=0;i<100;i++) document.getElementById("marquee-text").innerHTML += "\xa0\xa0\xa0Please connect, message, and meet the other members via Communities, Groups, Posts and Messages!";


function confirmDeletion(postid) {
    var msg = "Are you sure you want to delete this post？";
    swal({
        title: "Warning！",
        text: msg,
        icon: "warning",
        buttons: ["Cancel","Yes"],
        dangerMode: true,
    })
    .then((ok) => {
        if (ok) {
            window.location.href = "/mothers/delpost?post_id=" + postid + "&opt=home";
        }
    });
}


function toPostCreateForm() {
    var token = generate_token(200);
    window.sessionStorage.setItem('mw_token', token);
    window.open("/mothers/tonewpost?token=" + token) ;
}


function generate_token(length){
    //edit the token allowed characters
    var a = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split("");
    var b = [];
    for (var i=0; i<length; i++) {
        var j = (Math.random() * (a.length-1)).toFixed(0);
        b[i] = a[j];
    }
    return b.join("");
}


const channel = new BroadcastChannel("mw_post");
channel.addEventListener("message", e => {
    // console.log(e.data);
    if(e.data != null) {
        let data = JSON.parse(JSON.stringify(e.data));
        let token = data["token"];
        if(token.length > 0 && token == window.sessionStorage.getItem('mw_token')) {
            location.reload();
        }
    }
});


function collectionHas(a, b) { //helper function (see below)
    for(var i = 0, len = a.length; i < len; i ++) {
        if(a[i] == b) return true;
    }
    return false;
}

function findParentBySelector(elm, selector) {
    var all = document.querySelectorAll(selector);
    var cur = elm.parentNode;
    while(cur && !collectionHas(all, cur)) { //keep going up until you find a match
        cur = cur.parentNode; //go up
    }
    return cur; //will return null if not found
}


function updateReaction(option, postid, feeling) {
    console.log(option + " /// " + postid + " /// " + feeling)
    if(feeling == null) feeling = "";
    console.log(feeling)
    if(option == "mother") {
	    var formData = new FormData();
	    formData.append("post_id", postid);
	    formData.append("feeling", feeling);
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                let response = xhr.response;
                // console.log(response)
                if(response != "error") {
                    let resp = xhr.responseText;
                    // console.log(resp)
                    let data = JSON.parse(resp);
                    let post = data["post"];
                    let allfeelings = post["reactions"];  if(allfeelings.length == 0) allfeelings = "0";
                    document.getElementById("feelings-" + postid).innerHTML = allfeelings;
                    if(parseInt(allfeelings) == 0) document.getElementById("feelings-" + postid).style.display = "none";
                    else document.getElementById("feelings-" + postid).style.display = "block";
                    if(feeling.length == 0) document.getElementById("flbl-" + postid).innerHTML = "Like";
                    let likes = post["likes"]; if(likes.length == 0) likes = "0";
                    let loves = post["loves"]; if(loves.length == 0) loves = "0";
                    let haha = post["haha"]; if(haha.length == 0) haha = "0";
                    let wow = post["wow"]; if(wow.length == 0) wow = "0";
                    let sad = post["sad"]; if(sad.length == 0) sad = "0";
                    let angry = post["angry"]; if(angry.length == 0) angry = "0";
                    if(parseInt(likes) == 0) document.getElementById("like-" + postid).style.display = "none";
                    else document.getElementById("like-" + postid).style.display = "block";
                    if(parseInt(loves) == 0) document.getElementById("love-" + postid).style.display = "none";
                    else document.getElementById("love-" + postid).style.display = "block";
                    if(parseInt(haha) == 0) document.getElementById("haha-" + postid).style.display = "none";
                    else document.getElementById("haha-" + postid).style.display = "block";
                    if(parseInt(wow) == 0) document.getElementById("wow-" + postid).style.display = "none";
                    else document.getElementById("wow-" + postid).style.display = "block";
                    if(parseInt(sad) == 0) document.getElementById("sad-" + postid).style.display = "none";
                    else document.getElementById("sad-" + postid).style.display = "block";
                    if(parseInt(angry) == 0) document.getElementById("angry-" + postid).style.display = "none";
                    else document.getElementById("angry-" + postid).style.display = "block";
                }
            }
        };
        xhr.open('POST', "/mothers/react_post", true);
        xhr.send(formData);
	}
}


function openMessageBox(){
    document.getElementById('backgroundOverlay').style.display='block';
    document.getElementById('messageBox').style.display='block';
    document.getElementById('cohortBox').style.display='none';
    document.getElementById('groupBox').style.display='none';
}

function openCohortBox(){
    document.getElementById('backgroundOverlay').style.display='block';
    document.getElementById('cohortBox').style.display='block';
    document.getElementById('groupBox').style.display='none';
    // document.getElementById('messageBox').style.display='none';
}

function openGroupBox(){
    {% if groups %}
    document.getElementById('backgroundOverlay').style.display='block';
    document.getElementById('groupBox').style.display='block';
    // document.getElementById('messageBox').style.display='none';
    document.getElementById('cohortBox').style.display='none';
    {% else %}
    alert('You aren\'t in any communities yet.');
    {% endif %}
}

</script>

<script>

var endindx = 25;
var total_count = parseInt("{{total_count}}");

console.log(String(endindx) + " / " + String(total_count))

function refreshAtBottom() {
    let bottomProg = document.getElementsByClassName("bottom-progress")[0];
    bottomProg.style.display = "block";
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            // console.log('Result: ' + xhr.responseText)
            bottomProg.style.display = "none";
            let resp = xhr.responseText;
            let data = JSON.parse(resp);
            let result = data["result"];
            if (result == "success") {
                let html = data["html"];
                endindx = parseInt(data["endindx"]);
                total_count = parseInt(data["total_count"]);
                document.getElementById("post-container").innerHTML += html + "<br>";

                var y = document.getElementsByClassName("text");
                var i;
                for (i = 0; i < y.length; i++) {
                    y[i].innerHTML = urlify(y[i].innerHTML);
                    y[i].style.color = "white";
                    y[i].style.textAlign = "left";
                }
                $('.postform .text').each(function(i) {
                    const response = this.innerHTML
                    const decoded = response
                        .replace(/\\u(....)/g, (match, p1) => String.fromCharCode(parseInt(p1, 16)))
                        .replace(/\\(\d{3})/g, (match, p1) => String.fromCharCode(parseInt(p1,  8)))
                    this.innerHTML = decoded;
                });
                $('.FB_reactions').facebookReactions({
            		postUrl: "mother"
            	});
            }
        }
    };
    xhr.open('GET', '/mothers/hhhhhhh?endindx=' + String(endindx), true);
    xhr.send('');
}

document.getElementById("main-menu").addEventListener("click", openMainMenu);

document.getElementById("s-form").querySelector("input[name='q']").addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    document.getElementById("s-form").querySelector("button").click();
  }
});

function searchHome() {
    let q = document.getElementsByName("q")[0];
    if(q.value.length == 0) {
        showFailureAlert("Please enter a keyword.");
        return;
    }
    let form = document.getElementById("s-form");
    let formData = new FormData(form);
    let topProg = document.getElementsByClassName("top-progress")[0];
    topProg.style.display = "block";
    var xhr_s = new XMLHttpRequest();
    xhr_s.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            // console.log('Result: ' + xhr_s.responseText)
            topProg.style.display = "none";
            let resp = xhr_s.responseText;
            let data = JSON.parse(resp);
            let result = data["result"];
            if (result == "success") {
                let html = data["html"];
                total_count = parseInt(data["total_count"]);
                document.getElementById("post-container").innerHTML = html + "<br>";
                if(html.length == 0) document.getElementById("no_result").style.display = "block";
                else document.getElementById("no_result").style.display = "none";

                var y = document.getElementsByClassName("text");
                var i;
                for (i = 0; i < y.length; i++) {
                    y[i].innerHTML = urlify(y[i].innerHTML);
                    y[i].style.color = "white";
                    y[i].style.textAlign = "left";
                }
                $('.postform .text').each(function(i) {
                    const response = this.innerHTML
                    const decoded = response
                        .replace(/\\u(....)/g, (match, p1) => String.fromCharCode(parseInt(p1, 16)))
                        .replace(/\\(\d{3})/g, (match, p1) => String.fromCharCode(parseInt(p1,  8)))
                    this.innerHTML = decoded;
                });
                $('.FB_reactions').facebookReactions({
            		postUrl: "mother"
            	});
            }
        }
    };
    xhr_s.open('POST', '/mothers/nnnnnnnnn/', true);
    xhr_s.send(formData);
}

</script>


</body>





</html>




























































